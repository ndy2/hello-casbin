# hello-casbin

A simple example of using Casbin for hierarchical access control management.
This example demonstrates how to manage API keys, agents, microservice clusters (MCPs), and tools using Casbin's RBAC with domain support.

## 사전 준비

pgsql running - localhost:5432 with url `postgresql+psycopg2://rbac_user:yourpassword@localhost:5432/rbac`

```bash
pip install -r requirements.txt
```

## 실행 결과

```
=== 초기 상태 ===
Original Policy:
+-----------+-----------+-----------+-----------+-----------+
| API Key   | tool111   | tool112   | tool121   | tool122   |
+===========+===========+===========+===========+===========+
| alice     | ✔         | ✔         | ✔         | ✔         |
+-----------+-----------+-----------+-----------+-----------+
| bob       | ✔         | ✔         | ✘         | ✘         |
+-----------+-----------+-----------+-----------+-----------+
| ndy       | ✘         | ✘         | ✘         | ✔         |
+-----------+-----------+-----------+-----------+-----------+
All Policies with Hierarchy:
{
    "agent1": {
        "mcp11": [
            "tool111",
            "tool112"
        ],
        "mcp12": [
            "tool121",
            "tool122"
        ]
    }
}

=== 1. mcp12에 tool123 추가 ===
Original Policy:
+-----------+-----------+-----------+-----------+-----------+-----------+
| API Key   | tool111   | tool112   | tool121   | tool122   | tool123   |
+===========+===========+===========+===========+===========+===========+
| alice     | ✔         | ✔         | ✔         | ✔         | ✔         |
+-----------+-----------+-----------+-----------+-----------+-----------+
| bob       | ✔         | ✔         | ✘         | ✘         | ✘         |
+-----------+-----------+-----------+-----------+-----------+-----------+
| ndy       | ✘         | ✘         | ✘         | ✔         | ✘         |
+-----------+-----------+-----------+-----------+-----------+-----------+
All Policies with Hierarchy:
{
    "agent1": {
        "mcp11": [
            "tool111",
            "tool112"
        ],
        "mcp12": [
            "tool121",
            "tool122",
            "tool123"
        ]
    }
}

=== 2. mcp11에서 tool111 제거 ===
Original Policy:
+-----------+-----------+-----------+-----------+-----------+
| API Key   | tool112   | tool121   | tool122   | tool123   |
+===========+===========+===========+===========+===========+
| alice     | ✔         | ✔         | ✔         | ✔         |
+-----------+-----------+-----------+-----------+-----------+
| bob       | ✔         | ✘         | ✘         | ✘         |
+-----------+-----------+-----------+-----------+-----------+
| ndy       | ✘         | ✘         | ✔         | ✘         |
+-----------+-----------+-----------+-----------+-----------+
All Policies with Hierarchy:
{
    "agent1": {
        "mcp11": [
            "tool112"
        ],
        "mcp12": [
            "tool121",
            "tool122",
            "tool123"
        ]
    }
}

=== 3. new-api-key를 qa-group에 추가 ===
Original Policy:
+-------------+-----------+-----------+-----------+-----------+
| API Key     | tool112   | tool121   | tool122   | tool123   |
+=============+===========+===========+===========+===========+
| alice       | ✔         | ✔         | ✔         | ✔         |
+-------------+-----------+-----------+-----------+-----------+
| bob         | ✔         | ✘         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+
| ndy         | ✘         | ✘         | ✔         | ✘         |
+-------------+-----------+-----------+-----------+-----------+
| new-api-key | ✔         | ✘         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+
All Policies with Hierarchy:
{
    "agent1": {
        "mcp11": [
            "tool112"
        ],
        "mcp12": [
            "tool121",
            "tool122",
            "tool123"
        ]
    }
}

=== 4. hello-group, hello-key, agent2, mcp21, tool211, tool212 추가 ===
Original Policy:
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
| API Key     | tool112   | tool121   | tool122   | tool123   | tool211   | tool212   |
+=============+===========+===========+===========+===========+===========+===========+
| alice       | ✔         | ✔         | ✔         | ✔         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
| bob         | ✔         | ✘         | ✘         | ✘         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
| ndy         | ✘         | ✘         | ✔         | ✘         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
| new-api-key | ✔         | ✘         | ✘         | ✘         | ✘         | ✘         |
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
| hello-key   | ✘         | ✘         | ✘         | ✘         | ✔         | ✔         |
+-------------+-----------+-----------+-----------+-----------+-----------+-----------+
All Policies with Hierarchy:
{
    "agent1": {
        "mcp11": [
            "tool112"
        ],
        "mcp12": [
            "tool121",
            "tool122",
            "tool123"
        ]
    },
    "agent2": {
        "mcp21": [
            "tool211",
            "tool212"
        ]
    }
}
```
